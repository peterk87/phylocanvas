!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Phylocanvas=t():e.Phylocanvas=t()}(this,function(){return function(e){function t(n){if(a[n])return a[n].exports;var i=a[n]={exports:{},id:n,loaded:!1};return e[n].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var a={};return t.m=e,t.c=a,t.p="/dist/",t(0)}([function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}function i(e){return e&&e.__esModule?e:{"default":e}}function r(e,t,a){var n=e[t]?e:e.prototype,i=n[t];n[t]=function(){for(var e=arguments.length,t=Array(e),n=0;e>n;n++)t[n]=arguments[n];return a.call(this,i,t)}}function s(e){e.call(this,r)}function l(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];return new o["default"](e,t)}Object.defineProperty(t,"__esModule",{value:!0}),t.utils=t.nodeRenderers=t.treeTypes=t.Parser=t.Tooltip=t.Branch=t.Tree=void 0;var h=a(1),o=i(h),c=a(7),u=i(c),d=a(9),f=i(d),v=a(30),g=i(v),y=a(11),p=i(y),b=a(8),m=i(b),x=a(2),w=n(x);t.Tree=o["default"],t.Branch=u["default"],t.Tooltip=f["default"],t.Parser=g["default"],t.treeTypes=p["default"],t.nodeRenderers=m["default"],t.utils=w,t["default"]={plugin:s,createTree:l}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),l=a(2),h=a(7),o=n(h),c=a(9),u=a(10),d=n(u),f=a(11),v=n(f),g=a(29),y=n(g),p=l.dom.addClass,b=l.events.fireEvent,m=l.events.addEvent,x=l.canvas.getPixelRatio,w=l.canvas.translateClick,k=function(){function e(t){var a=this,n=arguments.length<=1||void 0===arguments[1]?{}:arguments[1];r(this,e),this.containerElement="string"==typeof t?document.getElementById(t):t,p(this.containerElement,"pc-container"),this.branches={},this.leaves=[],this.root=!1,this.stringRepresentation="",this.backColour=!1,this.originalTree={},"static"===window.getComputedStyle(this.containerElement).position&&(this.containerElement.style.position="relative"),this.containerElement.style.boxSizing="border-box";var i=document.createElement("canvas");i.id=(this.containerElement.id||"")+"__canvas",i.className="phylocanvas",i.style.position="relative",i.height=t.offsetHeight||400,i.width=t.offsetWidth||400,i.style.zIndex="1",this.containerElement.appendChild(i),this.defaultCollapsed={},this.tooltip=new c.ChildNodesTooltip(this),this.drawn=!1,this.highlighters=[],this.zoom=1,this.zoomFactor=.2,this.disableZoom=!1,this.fillCanvas=!1,this.branchScaling=!0,this.currentBranchScale=1,this.branchScalingStep=1.2,this.pickedup=!1,this.dragging=!1,this.startx=null,this.starty=null,this.pickedup=!1,this.baseNodeSize=1,this.curx=null,this.cury=null,this.origx=null,this.origy=null,this.canvas=i.getContext("2d"),this.canvas.canvas.onselectstart=function(){return!1},this.canvas.fillStyle="#000000",this.canvas.strokeStyle="#000000",this.canvas.save(),this.offsetx=this.canvas.canvas.width/2,this.offsety=this.canvas.canvas.height/2,this.selectedColour="rgba(49,151,245,1)",this.highlightColour="rgba(49,151,245,1)",this.highlightWidth=4,this.highlightSize=2,this.selectedNodeSizeIncrease=0,this.branchColour="rgba(0,0,0,1)",this.branchScalar=1,this.padding=50,this.labelPadding=5,this.multiSelect=!0,this.clickFlag="selected",this.clickFlagPredicate=function(){return!0},this.hoverLabel=!1,this.internalNodesSelectable=!0,this.showLabels=!1,this.showBootstraps=!1,this.setTreeType("circular"),this.maxBranchLength=0,this.lineWidth=1,this.textSize=7,this.font="sans-serif",this.unselectOnClickAway=!0,this.hovered=!1,this.useNavigator&&(this.navigator=new d["default"](this)),this.alignLabels=!0,this.farthestNodeFromRootX=0,this.farthestNodeFromRootY=0,this.maxLabelLength={},this.metadata=null,this.rect_multiplier=10,Object.assign(this,n),this.resizeToContainer(),this.drag_this=this.drag.bind(this),this.drop_this=this.drop.bind(this),this.pickup_this=this.pickup.bind(this),this.onhover_this=this.onhover.bind(this),this.addListener("click",this.clicked.bind(this)),this.addListener("mousedown",this.pickup_this),this.addListener("mouseup",this.drop_this),this.addListener("mouseout",this.drop_this),this.addListener("mousemove",this.onhover_this),this.scroll_this=this.scroll.bind(this),this.disableZoom||(m(this.canvas.canvas,"mousewheel",this.scroll_this),m(this.canvas.canvas,"DOMMouseScroll",this.scroll_this)),m(window,"resize",function(){a.resizeToContainer(),a.draw()})}return s(e,[{key:"setInitialCollapsedBranches",value:function(){var e,t,a=arguments.length<=0||void 0===arguments[0]?this.root:arguments[0];if(e=a.getChildProperties("id"),e&&e.length>this.defaultCollapsed.min&&e.length<this.defaultCollapsed.max)return void(a.collapsed=!0);for(t=0;t<a.children.length;t++)this.setInitialCollapsedBranches(a.children[t])}},{key:"getNodeAtMousePosition",value:function(e){var t;return(t=this.root).clicked.apply(t,i(w(e,this)))}},{key:"getSelectedNodeIds",value:function(){return this.getNodeIdsWithFlag("selected")}},{key:"getNodeIdsWithFlag",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?!0:arguments[1];return this.leaves.reduce(function(a,n){return n[e]===t&&a.push(n.id),a},[])}},{key:"clicked",value:function(e){var t;if(0===e.button){var a=[];if(this.dragging)return void(this.dragging=!1);if(!this.root)return!1;t=this.getNodeAtMousePosition(e);var n=this.multiSelect&&(e.metaKey||e.ctrlKey);if(t&&t.interactive)if(n){if(t.leaf)t[this.clickFlag]=!t[this.clickFlag];else if(this.internalNodesSelectable){var i=t.getChildProperties(this.clickFlag).some(function(e){return e===!1});t.cascadeFlag(this.clickFlag,i,this.clickFlagPredicate)}a=this.getNodeIdsWithFlag(this.clickFlag),this.draw()}else this.root.cascadeFlag(this.clickFlag,!1,this.clickFlagPredicate),(this.internalNodesSelectable||t.leaf)&&(t.cascadeFlag(this.clickFlag,!0,this.clickFlagPredicate),a=t.getChildProperties("id")),this.draw();else!this.unselectOnClickAway||this.dragging||n||(this.root.cascadeFlag(this.clickFlag,!1,this.clickFlagPredicate),this.draw());this.pickedup||(this.dragging=!1),this.nodesUpdated(a,this.clickFlag)}}},{key:"dblclicked",value:function(e){if(!this.root)return!1;var t=this.getNodeAtMousePosition(e);t&&(t.cascadeFlag("selected",!1),t.toggleCollapsed()),this.pickedup||(this.dragging=!1),this.draw()}},{key:"displayLabels",value:function(){this.showLabels=!0,this.draw()}},{key:"drag",value:function(e){if(!this.drawn)return!1;if(this.pickedup){var t=x(this.canvas),a=(e.clientX-this.startx)*t,n=(e.clientY-this.starty)*t;Math.abs(a)+Math.abs(n)>5&&(this.dragging=!0,this.offsetx=this.origx+a,this.offsety=this.origy+n,this.draw())}}},{key:"onhover",value:function(e){var t=e,a=this.getNodeAtMousePosition(t);a&&a.interactive&&(this.internalNodesSelectable||a.leaf)?(this.root.cascadeFlag("hovered",!1),a.hovered=!0,this.hovered=!0,a.leaf||a.hasCollapsedAncestor()||this.tooltip.open(t.clientX,t.clientY,a),this.containerElement.style.cursor="pointer",this.draw()):this.hovered&&(this.hovered=!1,this.root.cascadeFlag("hovered",!1),this.containerElement.style.cursor="auto",this.tooltip.close(),this.draw())}},{key:"draw",value:function(e){if(this.highlighters.length=0,0===this.maxBranchLength)return void this.loadError(new Error("All branches in the tree are identical."));this.canvas.restore(),this.canvas.clearRect(0,0,this.canvas.canvas.width,this.canvas.canvas.height),this.canvas.lineCap="round",this.canvas.lineJoin="round",this.canvas.strokeStyle=this.branchColour,this.canvas.save(),this.drawn&&!e||(this.prerenderer.run(this),e||this.fitInPanel());var t=x(this.canvas);this.canvas.lineWidth=this.lineWidth/this.zoom,this.canvas.translate(this.offsetx*t,this.offsety*t),this.canvas.scale(this.zoom,this.zoom),this.branchRenderer.render(this,this.root),this.highlighters.forEach(function(e){return e()}),this.drawn=!0}},{key:"drop",value:function(){return this.drawn?(this.pickedup=!1,void this.canvas.canvas.removeEventListener("mousemove",this.drag_this)):!1}},{key:"setMetadata",value:function(e){if(e){this.metadata=e;var t=!0,a=!1,n=void 0;try{for(var i,r=this.leaves[Symbol.iterator]();!(t=(i=r.next()).done);t=!0){var s=i.value,l=s.id,h=e[l];s.metadata=h}}catch(o){a=!0,n=o}finally{try{!t&&r["return"]&&r["return"]()}finally{if(a)throw n}}this.draw()}}},{key:"colorBranchesByLeafMetadata",value:function(){for(var e in this.branches)if(this.branches.hasOwnProperty(e)){var t=this.branches[e],a=t.getChildProperties("metadata");if(!a)continue;var n={},i=!0,r=!1,s=void 0;try{for(var l,h=a[Symbol.iterator]();!(i=(l=h.next()).done);i=!0){var o=l.value;if(o){var c=!0,u=!1,d=void 0;try{for(var f,v=o[Symbol.iterator]();!(c=(f=v.next()).done);c=!0){var g=f.value,y=g.color,p=g.count;n.hasOwnProperty(y)?n[y]+=p:n[y]=p}}catch(b){u=!0,d=b}finally{try{!c&&v["return"]&&v["return"]()}finally{if(u)throw d}}}}}catch(b){r=!0,s=b}finally{try{!i&&h["return"]&&h["return"]()}finally{if(r)throw s}}var m=null,x=0;for(var w in n){var k=n[w];k>x&&(x=k,m=w)}t.colour=m}}},{key:"setRectMetadataMultiplier",value:function(e){this.rect_multiplier=e,this.draw()}},{key:"findLeaves",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?"id":arguments[1],a=[],n=!0,i=!1,r=void 0;try{for(var s,l=this.leaves[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var h=s.value;h[t]&&h[t].match(e)&&a.push(h)}}catch(o){i=!0,r=o}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw r}}return a}},{key:"updateLeaves",value:function(e,t,a){var n=!0,i=!1,r=void 0;try{for(var s,l=this.leaves[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var h=s.value;h[t]=!a}}catch(o){i=!0,r=o}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw r}}var c=!0,u=!1,d=void 0;try{for(var f,v=e[Symbol.iterator]();!(c=(f=v.next()).done);c=!0){var g=f.value;g[t]=a}}catch(o){u=!0,d=o}finally{try{!c&&v["return"]&&v["return"]()}finally{if(u)throw d}}this.nodesUpdated(e.map(function(e){return e.id}),t)}},{key:"clearSelect",value:function(){this.root.cascadeFlag("selected",!1),this.draw()}},{key:"getPngUrl",value:function(){return this.canvas.canvas.toDataURL()}},{key:"hideLabels",value:function(){this.showLabels=!1,this.draw()}},{key:"load",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=arguments[2],n=t,i=a;if("function"==typeof t&&(i=t,n={}),i&&(n.callback=i),n.format)return void this.build(e,y["default"][n.format],n);var r=!0,s=!1,l=void 0;try{for(var h,o=Object.keys(y["default"])[Symbol.iterator]();!(r=(h=o.next()).done);r=!0){var c=h.value,u=y["default"][c];if(e.match(u.fileExtension)||e.match(u.validator))return void this.build(e,u,n)}}catch(d){s=!0,l=d}finally{try{!r&&o["return"]&&o["return"]()}finally{if(s)throw l}}var f=new Error("String not recognised as a file or a parseable format string");i&&i(f),this.loadError(f)}},{key:"saveOriginalTree",value:function(){this.originalTree.branches=this.branches,this.originalTree.leaves=this.leaves,this.originalTree.root=this.root,this.originalTree.branchLengths={},this.originalTree.parents={}}},{key:"clearState",value:function(){this.root=!1,this.leaves=[],this.branches={},this.drawn=!1}},{key:"saveState",value:function(){return this.extractNestedBranches(),this.root.branchLength=0,this.maxBranchLength=0,this.root.setTotalLength(),0===this.maxBranchLength?void this.loadError(new Error("All branches in the tree are identical.")):void 0}},{key:"build",value:function(e,t,a){var n=this;this.originalTree={},this.clearState(),o["default"].lastId=0;var i=new o["default"];i.id="root",this.branches.root=i,this.setRoot(i),t.parse({formatString:e,root:i,options:a},function(t){return t?(a.callback&&a.callback(t),void n.loadError(t)):(n.stringRepresentation=e,n.saveState(),n.setInitialCollapsedBranches(),n.draw(),n.saveOriginalTree(),a.callback&&a.callback(),void n.loadCompleted())})}},{key:"pickup",value:function(e){return this.drawn?(this.origx=this.offsetx,this.origy=this.offsety,0===e.button&&(this.pickedup=!0),this.startx=e.clientX,this.starty=e.clientY,void this.canvas.canvas.addEventListener("mousemove",this.drag_this)):!1}},{key:"redrawFromBranch",value:function(e){this.clearState(),this.resetTree(),this.originalTree.branchLengths[e.id]=e.branchLength,this.originalTree.parents[e.id]=e.parent,this.root=e,this.root.parent=!1,this.saveState(),this.draw(),this.subtreeDrawn(e.id)}},{key:"redrawOriginalTree",value:function(){this.load(this.stringRepresentation)}},{key:"storeNode",value:function(e){if(e.id&&""!==e.id||(e.id=o["default"].generateId()),this.branches[e.id]&&e!==this.branches[e.id]){if(e.leaf)throw new Error("Two nodes on this tree share the id "+e.id);e.id=o["default"].generateId()}this.branches[e.id]=e,e.leaf&&this.leaves.push(e)}},{key:"scroll",value:function(e){var t=this;if(e.preventDefault(),!(this._zooming||"wheelDelta"in e&&0===e.wheelDelta)){var a=e.detail<0||e.wheelDelta>0?1:-1;if(this.branchScaling&&(e.metaKey||e.ctrlKey))this.currentBranchScale*=Math.pow(this.branchScalingStep,a),this.setBranchScale(this.currentBranchScale,{x:e.offsetX,y:e.offsetY});else{var n=Math.log(this.zoom)/Math.log(10)+a*this.zoomFactor;this.setZoom(n,e.offsetX,e.offsetY)}this._zooming=!0,setTimeout(function(){t._zooming=!1},128)}}},{key:"selectNodes",value:function(e){var t,a,n,i=e;if(this.root){this.root.cascadeFlag("selected",!1),"string"==typeof e&&(i=i.split(","));for(a in this.branches)if(this.branches.hasOwnProperty(a))for(t=this.branches[a],n=0;n<i.length;n++)i[n]===t.id&&t.cascadeFlag("selected",!0);this.draw()}}},{key:"setFont",value:function(e){isNaN(e)&&(this.font=e,this.draw())}},{key:"setNodeDisplay",value:function(e,t,a){var n=this;if(e)if(this.drawn){var i=[];if(i="string"==typeof e?e.split(","):e,i.length){var r=!0,s=!1,l=void 0;try{for(var h,o=i[Symbol.iterator]();!(r=(h=o.next()).done);r=!0){var c=h.value;c in this.branches&&this.branches[c].setDisplay(t)}}catch(u){s=!0,l=u}finally{try{!r&&o["return"]&&o["return"]()}finally{if(s)throw l}}this.draw()}}else a||!function(){var a=n,i=setInterval(function(){this.drawn&&(a.setNodeColourAndShape(e,t,!0),clearInterval(i))})}()}},{key:"setNodeSize",value:function(e){this.baseNodeSize=Number(e),this.draw()}},{key:"setRoot",value:function(e){e.canvas=this.canvas,e.tree=this,this.root=e}},{key:"setTextSize",value:function(e){this.textSize=Number(e),this.draw()}},{key:"setFontSize",value:function(e){this.textSize=this.calculateFontSize?this.calculateFontSize(e):Math.min(e/2,15),this.canvas.font=this.textSize+"pt "+this.font}},{key:"setTreeType",value:function(e,t){if(!(e in v["default"]))return b(this.containerElement,"error",{error:new Error('"'+e+'" is not a known tree-type.')});var a=this.treeType;this.treeType=e,this.branchRenderer=v["default"][e].branchRenderer,this.prerenderer=v["default"][e].prerenderer,this.labelAlign=v["default"][e].labelAlign,this.scaleCollapsedNode=v["default"][e].scaleCollapsedNode,this.calculateFontSize=v["default"][e].calculateFontSize,this.drawn&&(this.drawn=!1,this.draw()),t||this.treeTypeChanged(a,e)}},{key:"setSize",value:function(e,t){this.canvas.canvas.width=e,this.canvas.canvas.height=t,this.navigator&&this.navigator.resize(),this.adjustForPixelRatio()}},{key:"setZoom",value:function(e){var t=arguments.length<=1||void 0===arguments[1]?this.canvas.canvas.width/2:arguments[1],a=arguments.length<=2||void 0===arguments[2]?this.canvas.canvas.height/2:arguments[2];if(e>-2&&2>e){var n=this.zoom,i=Math.pow(10,e);this.zoom=i,this.offsetx=this.calculateZoomedOffset(this.offsetx,t,n,i),this.offsety=this.calculateZoomedOffset(this.offsety,a,n,i),this.draw()}}},{key:"calculateZoomedOffset",value:function(e,t,a,n){return-1*((-1*e+t)/a*n-t)}},{key:"setBranchScale",value:function(){var e=arguments.length<=0||void 0===arguments[0]?1:arguments[0],t=arguments.length<=1||void 0===arguments[1]?{x:this.canvas.canvas.width/2,y:this.canvas.canvas.height/2}:arguments[1],a=v["default"][this.treeType];if(a.branchScalingAxis&&!(0>e)){var n=this.branchScalar;this.branchScalar=this.initialBranchScalar*e;var i=this.branchScalar/n,r=this["offset"+a.branchScalingAxis],s=t[a.branchScalingAxis],l=(t[a.branchScalingAxis]-r)*i+r;this["offset"+a.branchScalingAxis]+=s-l,this.draw()}}},{key:"toggleLabels",value:function(){this.showLabels=!this.showLabels,this.draw()}},{key:"setMaxLabelLength",value:function(){var e;void 0===this.maxLabelLength[this.treeType]&&(this.maxLabelLength[this.treeType]=0);for(var t=0;t<this.leaves.length;t++)e=this.canvas.measureText(this.leaves[t].id),e.width>this.maxLabelLength[this.treeType]&&(this.maxLabelLength[this.treeType]=e.width)}},{key:"loadCompleted",value:function(){b(this.containerElement,"loaded")}},{key:"loadStarted",value:function(){b(this.containerElement,"loading")}},{key:"loadError",value:function(e){b(this.containerElement,"error",{error:e})}},{key:"subtreeDrawn",value:function(e){b(this.containerElement,"subtree",{node:e})}},{key:"nodesUpdated",value:function(e,t){var a=arguments.length<=2||void 0===arguments[2]?!1:arguments[2];b(this.containerElement,"updated",{nodeIds:e,property:t,append:a})}},{key:"addListener",value:function(e,t){m(this.containerElement,e,t)}},{key:"getBounds",value:function(){var e=arguments.length<=0||void 0===arguments[0]?this.leaves:arguments[0],t=e[0].startx,a=e[0].startx,n=e[0].starty,i=e[0].starty,r=!0,s=!1,l=void 0;try{for(var h,o=e[Symbol.iterator]();!(r=(h=o.next()).done);r=!0){var c=h.value,u=c.getBounds();t=Math.min(t,u.minx),a=Math.max(a,u.maxx),n=Math.min(n,u.miny),i=Math.max(i,u.maxy)}}catch(d){s=!0,l=d}finally{try{!r&&o["return"]&&o["return"]()}finally{if(s)throw l}}return[[t,n],[a,i]]}},{key:"fitInPanel",value:function(){var e=arguments.length<=0||void 0===arguments[0]?this.getBounds():arguments[0],t=[this.canvas.canvas.width-2*this.padding,this.canvas.canvas.height-2*this.padding],a=[e[1][0]-e[0][0],e[1][1]-e[0][1]],n=x(this.canvas),i=t[0]/a[0],r=t[1]/a[1];this.zoom=Math.min(i,r),this.offsetx=-1*e[0][0]*this.zoom,this.offsety=-1*e[0][1]*this.zoom,i>r?(this.offsetx+=this.padding+(t[0]-a[0]*this.zoom)/2,this.offsety+=this.padding):(this.offsetx+=this.padding,this.offsety+=this.padding+(t[1]-a[1]*this.zoom)/2),this.offsetx=this.offsetx/n,this.offsety=this.offsety/n}},{key:"adjustForPixelRatio",value:function(){var e=x(this.canvas);this.canvas.canvas.style.height=this.canvas.canvas.height+"px",this.canvas.canvas.style.width=this.canvas.canvas.width+"px",e>1&&(this.canvas.canvas.width*=e,this.canvas.canvas.height*=e)}},{key:"treeTypeChanged",value:function(e,t){b(this.containerElement,"typechanged",{oldType:e,newType:t})}},{key:"resetTree",value:function(){if(this.originalTree.branches){this.branches=this.originalTree.branches;var e=!0,t=!1,a=void 0;try{for(var n,i=Object.keys(this.originalTree.branchLengths)[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var r=n.value;this.branches[r].branchLength=this.originalTree.branchLengths[r],this.branches[r].parent=this.originalTree.parents[r]}}catch(s){t=!0,a=s}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw a}}this.leaves=this.originalTree.leaves,this.root=this.originalTree.root}}},{key:"rotateBranch",value:function(e){this.branches[e.id].rotate()}},{key:"extractNestedBranches",value:function(){this.branches={},this.leaves=[],this.storeNode(this.root),this.root.extractChildren()}},{key:"exportNwk",value:function(){var e=this.root.getNwk();return e.substr(0,e.lastIndexOf(")")+1)+";"}},{key:"resizeToContainer",value:function(){this.setSize(this.containerElement.offsetWidth,this.containerElement.offsetHeight)}},{key:"alignLabels",get:function(){return this.labelAlign&&this.labelAlignEnabled},set:function(e){this.labelAlignEnabled=e}}]),e}();t["default"]=k,k.prototype.on=k.prototype.addListener},function(e,t,a){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&(t[a]=e[a]);return t["default"]=e,t}Object.defineProperty(t,"__esModule",{value:!0}),t.events=t.dom=t.constants=t.canvas=void 0;var i=a(3),r=n(i),s=a(6),l=n(s),h=a(4),o=n(h),c=a(5),u=n(c);t.canvas=r,t.constants=l,t.dom=o,t.events=u},function(e,t,a){"use strict";function n(e){return e.backingStorePixelRatio||e.webkitBackingStorePixelRatio||e.mozBackingStorePixelRatio||e.msBackingStorePixelRatio||e.oBackingStorePixelRatio||1}function i(e){return(window.devicePixelRatio||1)/n(e)}function r(e,t){var a=i(t.canvas);return[(e.offsetX-t.offsetx)/t.zoom*a,(e.offsetY-t.offsety)/t.zoom*a]}function s(e,t){var a=e.x,n=e.y,r=i(t.canvas);return{x:a?(a-t.offsetx)/t.zoom*r:null,y:n?(n-t.offsety)/t.zoom*r:null}}function l(e,t){var a=e.x,n=e.y,r=i(t.canvas);return{x:a?a/r*t.zoom+t.offsetx:null,y:n?n/r*t.zoom+t.offsety:null}}Object.defineProperty(t,"__esModule",{value:!0}),t.getBackingStorePixelRatio=n,t.getPixelRatio=i,t.translateClick=r,t.translatePoint=s,t.undoPointTranslation=l;a(4)},function(e,t,a){"use strict";function n(e){var t=arguments.length<=1||void 0===arguments[1]?"text/plain;charset=utf-8":arguments[1],a=new Blob([e],{type:t});return u.createObjectURL(a)}function i(e,t){var a=document.createElement("a"),n="undefined"!=typeof a.download;a.href=e,a.target="_blank",n&&(a.download=t),(0,c.fireEvent)(a,"click"),n&&u.revokeObjectURL(a.href)}function r(e){for(var t=0;e;)t+=e.offsetLeft,e=e.offsetParent;return t}function s(e){for(var t=0;e;)t+=e.offsetTop,e=e.offsetParent;return t}function l(e,t){var a=e.className.split(" ");-1===a.indexOf(t)&&(a.push(t),e.className=a.join(" "))}function h(e,t){var a=e.className.split(" "),n=a.indexOf(t);-1!==n&&(a.splice(n,1),e.className=a.join(" "))}function o(e,t){var a=e.className.split(" "),n=a.indexOf(t);return-1!==n}Object.defineProperty(t,"__esModule",{value:!0}),t.createBlobUrl=n,t.setupDownloadLink=i,t.getX=r,t.getY=s,t.addClass=l,t.removeClass=h,t.hasClass=o;var c=a(5),u=window.URL||window.webkitURL},function(e,t){"use strict";function a(e){return e.preventDefault(),!1}function n(e,t){var a,n,i=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];document.createEvent?(a=document.createEvent("HTMLEvents"),a.initEvent(t,!0,!0)):(a=document.createEventObject(),a.eventType=t),a.eventName=t;for(n in i)i.hasOwnProperty(n)&&(a[n]=i[n]);document.createEvent?e.dispatchEvent(a):e.fireEvent("on"+a.eventType,a)}function i(e,t,a){e.addEventListener?e.addEventListener(t,a,!1):e.attachEvent("on"+t,function(){return a.call(e,window.event)})}function r(e){e.stopPropagation(),e.preventDefault()}function s(e,t){var a;return a=("undefined"==typeof t?"undefined":l(t))===l("aaa")?function(a){return e[t]?e[t](a):void 0}:function(){return t(e)}}Object.defineProperty(t,"__esModule",{value:!0});var l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol?"symbol":typeof e};t.preventDefault=a,t.fireEvent=n,t.addEvent=i,t.killEvent=r,t.createHandler=s},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.Angles={FORTYFIVE:Math.PI/4,QUARTER:Math.PI/2,HALF:Math.PI,FULL:2*Math.PI},t.Shapes={x:"star",s:"square",o:"circle",t:"triangle",r:"rectangle",p:"pie",c:"circlestack"}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),s=a(2),l=a(8),h=n(l),o=s.constants.Angles,c=s.constants.Shapes,u={minx:0,maxx:0,miny:0,maxy:0},d={lineWidth:null,strokeStyle:null,fillStyle:null},f=function(){function e(){i(this,e),this.angle=0,this.branchLength=!1,this.canvas=null,this.centerx=0,this.centery=0,this.children=[],this.collapsed=!1,this.colour=null,this.data={},this.highlighted=!1,this.hovered=!1,this.id="",this.interx=0,this.intery=0,this.label=null,this.leaf=!0,this.maxChildAngle=0,this.minChildAngle=o.FULL,this.nodeShape="rectangle",this.parent=null,this.radius=10,this.selected=!1,this.startx=0,this.starty=0,this.totalBranchLength=0,this.tree={},this.pruned=!1,this.labelStyle={},this.interactive=!0,this.leafStyle={}}return r(e,[{key:"clicked",value:function(e,t){var a,n;if(!this.dragging){if(e<this.maxx&&e>this.minx&&t<this.maxy&&t>this.miny)return this;for(a=this.children.length-1;a>=0;a--)if(n=this.children[a].clicked(e,t))return n}}},{key:"drawLabel",value:function(){var e=this.getTextSize(),t=this.getLabel();this.canvas.font=this.getFontString(),this.labelWidth=this.canvas.measureText(t).width,void 0===this.tree.maxLabelLength[this.tree.treeType]&&(this.tree.maxLabelLength[this.tree.treeType]=0),this.labelWidth>this.tree.maxLabelLength[this.tree.treeType]&&(this.tree.maxLabelLength[this.tree.treeType]=this.labelWidth);var a=this.getLabelStartX();this.tree.alignLabels&&(a+=Math.abs(this.tree.labelAlign.getLabelOffset(this))),this.angle>o.QUARTER&&this.angle<o.HALF+o.QUARTER&&(this.canvas.rotate(o.HALF),a=-a-1*this.labelWidth),this.canvas.beginPath(),this.canvas.fillStyle=this.getTextColour(),this.canvas.fillText(t,a,e/2),this.canvas.closePath(),this.angle>o.QUARTER&&this.angle<o.HALF+o.QUARTER&&this.canvas.rotate(o.HALF)}},{key:"setNodeDimensions",value:function(e,t,a){var n=a;(a*this.tree.zoom<5||!this.leaf)&&(n=5/this.tree.zoom),this.minx=e-n,this.maxx=e+n,this.miny=t-n,this.maxy=t+n}},{key:"drawCollapsed",value:function(e,t){var a=this.getChildProperties("id"),n=a.length;this.tree.scaleCollapsedNode&&(n=this.tree.scaleCollapsedNode(n)),this.canvas.globalAlpha=.3,this.canvas.beginPath(),this.canvas.arc(e,t,n,0,2*Math.PI,!1),this.canvas.fillStyle=this.tree.defaultCollapsed.color?this.tree.defaultCollapsed.color:"purple",this.canvas.fill(),this.canvas.globalAlpha=1,this.canvas.closePath()}},{key:"drawLabelConnector",value:function(){var e=this.tree,t=e.highlightColour,a=e.labelAlign;this.canvas.save(),this.canvas.lineWidth=this.canvas.lineWidth/4,this.canvas.strokeStyle=this.isHighlighted?t:this.getColour(),this.canvas.beginPath(),this.canvas.moveTo(this.getRadius(),0),this.canvas.lineTo(a.getLabelOffset(this)+this.getDiameter(),0),this.canvas.stroke(),this.canvas.closePath(),this.canvas.restore()}},{key:"drawLeaf",value:function(){var e=this.tree,t=e.alignLabels,a=e.canvas,n=0;t&&(this.drawLabelConnector(),n=this.getLabelStartX()+Math.abs(this.tree.labelAlign.getLabelOffset(this))),(this.tree.showLabels||this.tree.hoverLabel&&this.isHighlighted)&&this.drawLabel();var i={};i.offset=Math.abs(n),this.metadata&&(i.metadata=this.metadata),i.rect_multiplier=this.tree.rect_multiplier,h["default"][this.nodeShape](a,this.getRadius(),this.getLeafStyle(),i)}},{key:"drawHighlight",value:function(e,t){this.canvas.save(),this.canvas.beginPath(),this.canvas.strokeStyle=this.tree.highlightColour,this.canvas.lineWidth=this.getHighlightLineWidth();var a=this.getHighlightRadius();this.canvas.arc(e,t,a,0,o.FULL,!1),this.canvas.stroke(),this.canvas.closePath(),this.canvas.restore()}},{key:"drawNode",value:function(){var e=this.getRadius(),t=e,a=this.leaf?t*Math.cos(this.angle)+this.centerx:this.centerx,n=this.leaf?t*Math.sin(this.angle)+this.centery:this.centery;this.setNodeDimensions(a,n,e),this.collapsed?this.drawCollapsed(a,n):this.leaf&&(this.canvas.save(),this.canvas.translate(this.centerx,this.centery),this.canvas.rotate(this.angle),this.drawLeaf(),this.canvas.restore()),this.isHighlighted&&this.tree.highlighters.push(this.drawHighlight.bind(this,a,n))}},{key:"getChildProperties",value:function(e){if(this.leaf)return[this[e]];for(var t=[],a=0;a<this.children.length;a++)t=t.concat(this.children[a].getChildProperties(e));return t}},{key:"getChildCount",value:function(){if(this.leaf)return 1;for(var e=0,t=0;t<this.children.length;t++)e+=this.children[t].getChildCount();return e}},{key:"getChildYTotal",value:function(){if(this.leaf)return this.centery;for(var e=0,t=0;t<this.children.length;t++)e+=this.children[t].getChildYTotal();return e}},{key:"cascadeFlag",value:function(e,t,a){if("undefined"==typeof this[e])throw new Error("Unknown property: "+e);("undefined"==typeof a||a(this,e,t))&&(this[e]=t);var n=!0,i=!1,r=void 0;try{for(var s,l=this.children[Symbol.iterator]();!(n=(s=l.next()).done);n=!0){var h=s.value;h.cascadeFlag(e,t,a)}}catch(o){i=!0,r=o}finally{try{!n&&l["return"]&&l["return"]()}finally{if(i)throw r}}}},{key:"reset",value:function(){var e,t;for(this.startx=0,this.starty=0,this.centerx=0,this.centery=0,this.angle=null,this.minChildAngle=o.FULL,this.maxChildAngle=0,t=0;t<this.children.length;t++)try{this.children[e].pcReset()}catch(a){return a}}},{key:"redrawTreeFromBranch",value:function(){this.collapsed&&this.expand(),this.tree.redrawFromBranch(this)}},{key:"extractChildren",value:function(){var e=!0,t=!1,a=void 0;try{for(var n,i=this.children[Symbol.iterator]();!(e=(n=i.next()).done);e=!0){var r=n.value;this.tree.storeNode(r),r.extractChildren()}}catch(s){t=!0,a=s}finally{try{!e&&i["return"]&&i["return"]()}finally{if(t)throw a}}}},{key:"hasCollapsedAncestor",value:function(){return this.parent?this.parent.collapsed||this.parent.hasCollapsedAncestor():!1}},{key:"collapse",value:function(){this.collapsed=this.leaf===!1}},{key:"expand",value:function(){this.collapsed=!1}},{key:"toggleCollapsed",value:function(){this.collapsed?this.expand():this.collapse()}},{key:"setTotalLength",value:function(){var e;for(this.parent?(this.totalBranchLength=this.parent.totalBranchLength+this.branchLength,this.totalBranchLength>this.tree.maxBranchLength&&(this.tree.maxBranchLength=this.totalBranchLength)):(this.totalBranchLength=this.branchLength,this.tree.maxBranchLength=this.totalBranchLength),e=0;e<this.children.length;e++)this.children[e].setTotalLength()}},{key:"addChild",value:function(e){e.parent=this,e.canvas=this.canvas,e.tree=this.tree,this.leaf=!1,this.children.push(e)}},{key:"getChildColours",value:function(){var e=[];return this.children.forEach(function(t){var a=0===t.children.length?t.colour:t.getColour();-1===e.indexOf(a)&&e.push(a)}),e}},{key:"getColour",value:function(e){return this.selected?this.tree.selectedColour:e||this.colour||this.tree.branchColour}},{key:"getNwk",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];if(this.leaf)return this.label+":"+this.branchLength;var t=this.children.map(function(e){return e.getNwk(!1)});return"("+t.join(",")+"):"+this.branchLength+(e?";":"")}},{key:"getTextColour",value:function(){if(this.selected)return this.tree.selectedColour;if(this.isHighlighted)return this.tree.highlightColour;if(this.tree.backColour&&this.children.length){var e=this.getChildColours();if(1===e.length)return e[0]}return this.labelStyle.colour||this.colour||this.tree.branchColour}},{key:"getLabel",value:function(){return void 0!==this.label&&null!==this.label?this.label:""}},{key:"getTextSize",value:function(){return this.labelStyle.textSize||this.tree.textSize}},{key:"getFontString",value:function(){var e=this.labelStyle.font||this.tree.font;return(this.labelStyle.format||"")+" "+this.getTextSize()+"pt "+e}},{key:"getLabelSize",value:function(){return this.canvas.font=this.getFontString(),this.canvas.measureText(this.getLabel()).width}},{key:"getRadius",value:function(){return this.leaf?this.tree.baseNodeSize*this.radius:this.tree.baseNodeSize/this.radius}},{key:"getDiameter",value:function(){return 2*this.getRadius()}},{key:"hasLabelConnector",
value:function(){return this.tree.alignLabels?this.tree.labelAlign.getLabelOffset(this)>this.getDiameter():!1}},{key:"getLabelStartX",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],t=this.getLeafStyle(e),a=t.lineWidth,n=this.hasLabelConnector(),i=this.getDiameter();return this.isHighlighted&&!n&&(i+=this.getHighlightSize(e)-this.getRadius()),this.isHighlighted||n||(i+=a/2),i+Math.min(this.tree.labelPadding,this.tree.labelPadding/(e?this.tree.zoom:1))}},{key:"getHighlightLineWidth",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return this.tree.highlightWidth/(e?this.tree.zoom:1)}},{key:"getHighlightRadius",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],t=this.getHighlightLineWidth(e)*this.tree.highlightSize;return t+=this.getLeafStyle(e).lineWidth/this.tree.highlightSize,this.leaf?this.getRadius()+t:.666*t}},{key:"getHighlightSize",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0];return this.getHighlightRadius(e)+this.getHighlightLineWidth(e)}},{key:"rotate",value:function(e){for(var t=[],a=this.children.length;a--;)t.push(this.children[a]);this.children=t,e.preventredraw||(this.tree.extractNestedBranches(),this.tree.draw(!0))}},{key:"getChildNo",value:function(){return this.parent.children.indexOf(this)}},{key:"setDisplay",value:function(e){var t=e.colour,a=e.shape,n=e.size,i=e.leafStyle,r=e.labelStyle;t&&(this.colour=t),a&&(this.nodeShape=c[a]?c[a]:a),n&&(this.radius=n),i&&(this.leafStyle=i),r&&(this.labelStyle=r)}},{key:"getTotalLength",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],t=this.getRadius();return(this.tree.showLabels||this.tree.hoverLabel&&this.isHighlighted)&&(t+=this.getLabelStartX(e)+this.getLabelSize()),t}},{key:"getBounds",value:function(){var e=this.tree,t=e.alignLabels?e.labelAlign.getX(this):this.centerx,a=e.alignLabels?e.labelAlign.getY(this):this.centery,n=this.getRadius(),i=this.getTotalLength(!1),r=void 0,s=void 0,l=void 0,h=void 0;this.angle>o.QUARTER&&this.angle<o.HALF+o.QUARTER?(r=t+i*Math.cos(this.angle),l=a+i*Math.sin(this.angle),s=t-n,h=a-n):(r=t-n,l=a-n,s=t+i*Math.cos(this.angle),h=a+i*Math.sin(this.angle));var c=e.prerenderer.getStep(e);return u.minx=Math.min(r,s,t-c),u.miny=Math.min(l,h,a-c),u.maxx=Math.max(r,s,t+c),u.maxy=Math.max(l,h,a+c),u}},{key:"getLeafStyle",value:function(){var e=arguments.length<=0||void 0===arguments[0]?!0:arguments[0],t=this.leafStyle,a=t.strokeStyle,n=t.fillStyle,i=this.tree.zoom;d.strokeStyle=this.getColour(a),d.fillStyle=this.getColour(n);var r="undefined"!=typeof this.leafStyle.lineWidth?this.leafStyle.lineWidth:this.tree.lineWidth;return d.lineWidth=r/(e?i:1),d}},{key:"isHighlighted",get:function(){return this.highlighted||this.hovered}}],[{key:"generateId",value:function(){return"pcn"+this.lastId++}}]),e}();f.lastId=0,t["default"]=f},function(e,t,a){"use strict";function n(e,t){e.beginPath(),e.moveTo(0,0),e.lineTo(t,0),e.stroke(),e.closePath()}function i(e,t){var a=t.lineWidth,n=t.strokeStyle,i=t.fillStyle;e.save(),e.lineWidth=a,e.strokeStyle=n,e.fillStyle=i,e.fill(),a>0&&n!==i&&e.stroke(),e.restore()}Object.defineProperty(t,"__esModule",{value:!0});var r=a(2),s=r.constants.Angles,l=function(e){return e*Math.sqrt(2)};t["default"]={circle:function(e,t,a){var r=Math.pow(l(t),2),h=Math.sqrt(r/Math.PI);n(e,t-h),e.beginPath(),e.arc(t,0,h,0,s.FULL,!1),e.closePath(),i(e,a)},square:function(e,t,a){var r=l(t),s=t-r/2;n(e,s),e.beginPath(),e.moveTo(s,0),e.lineTo(s,r/2),e.lineTo(s+r,r/2),e.lineTo(s+r,-r/2),e.lineTo(s,-r/2),e.lineTo(s,0),e.closePath(),i(e,a)},star:function(e,t,a){var r=t,s=0,l=5,h=t,o=.5*h,c=Math.PI/l;n(e,h-o);var u=Math.PI/2*3;e.beginPath(),e.moveTo(r,s-h);for(var d=0;l>d;d++){var f=r+Math.cos(u)*h,v=s+Math.sin(u)*h;e.lineTo(f,v),u+=c,f=r+Math.cos(u)*o,v=s+Math.sin(u)*o,e.lineTo(f,v),u+=c}e.lineTo(r,s-h),e.closePath(),i(e,a)},triangle:function(e,t,a){var r=2*t*Math.cos(30*Math.PI/180),s=Math.sqrt(3)/2*r,l=1/Math.sqrt(3)*(r/2);n(e,t-l),e.beginPath(),e.moveTo(t,l),e.lineTo(t+r/2,l),e.lineTo(t,-(s-l)),e.lineTo(t-r/2,l),e.lineTo(t,l),e.closePath(),i(e,a)},rectangle:function(e,t,a,n){var i=n.offset,r=n.metadata,s=n.rect_multiplier,h=l(t);i||(i=t);var o=i-h/2,c=r;c||(c=[{color:"black",count:1}]);var u=c.map(function(e){return e.count}).reduce(function(e,t){return e+t}),d=u*s,f=!0,v=!1,g=void 0;try{for(var y,p=c[Symbol.iterator]();!(f=(y=p.next()).done);f=!0){var b=y.value,m=b.color,x=b.count,w=x/u*d;e.fillStyle=m,e.fillRect(o,-h/2,w,h),o+=w}}catch(k){v=!0,g=k}finally{try{!f&&p["return"]&&p["return"]()}finally{if(v)throw g}}},circlestack:function(e,t,a,n){var i=n.offset,r=n.metadata,h=Math.pow(l(t),2),o=Math.sqrt(h/Math.PI),c=r;c||(c=[{color:"black",count:1}]);var u=c.map(function(e){return e.count}).reduce(function(e,t){return Math.max(e,t)}),d=!0,f=!1,v=void 0;try{for(var g,y=c[Symbol.iterator]();!(d=(g=y.next()).done);d=!0){var p=g.value,b=p.color,m=p.count,x=o*(m/u);e.fillStyle=b,e.beginPath(),m>0&&(i+=x),e.arc(i,0,x,0,s.FULL,!1),e.lineTo(i,0),e.fill(),e.closePath(),i+=x,m+=1}}catch(w){f=!0,v=w}finally{try{!d&&y["return"]&&y["return"]()}finally{if(f)throw v}}},pie:function(e,t,a,n){var i=n.offset,r=n.metadata,h=Math.pow(l(t),2),o=Math.sqrt(h/Math.PI),c=r;c||(c=[{color:"black",count:1}]);var u=c.map(function(e){return e.count}).reduce(function(e,t){return e+t}),d=0,f=0,v=!0,g=!1,y=void 0;try{for(var p,b=c[Symbol.iterator]();!(v=(p=b.next()).done);v=!0){var m=p.value,x=m.color,w=m.count;f=d+w/u*s.FULL,e.fillStyle=x,e.beginPath(),e.arc(i,0,o,d,f,!1),e.lineTo(i,0),e.fill(),e.closePath(),d=f}}catch(k){g=!0,y=k}finally{try{!v&&b["return"]&&b["return"]()}finally{if(g)throw y}}}}},function(e,t){"use strict";function a(e){var t=arguments.length<=1||void 0===arguments[1]?{}:arguments[1],a=t.className,n=void 0===a?"phylocanvas-tooltip":a,i=t.element,r=void 0===i?document.createElement("div"):i,s=t.zIndex,l=void 0===s?2e3:s,h=t.parent,o=void 0===h?e.containerElement:h;this.tree=e,this.element=r,this.element.className=n,this.element.style.display="none",this.element.style.position="fixed",this.element.style.zIndex=l,this.closed=!0,o.appendChild(this.element)}function n(e,t){a.call(this,e,t),this.element.style.background="rgba(97, 97, 97, 0.9)",this.element.style.color="#fff",this.element.style.cursor="pointer",this.element.style.padding="8px",this.element.style.marginTop="16px",this.element.style.borderRadius="2px",this.element.style.textAlign="center",this.element.style.fontFamily=this.tree.font||"sans-serif",this.element.style.fontSize="10px",this.element.style.fontWeight="500"}Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=a,t.ChildNodesTooltip=n,a.prototype.close=function(){this.element.style.display="none",this.closed=!0},a.prototype.open=function(){for(var e=arguments.length<=0||void 0===arguments[0]?100:arguments[0],t=arguments.length<=1||void 0===arguments[1]?100:arguments[1],a=arguments[2];this.element.hasChildNodes();)this.element.removeChild(this.element.firstChild);this.createContent(a),this.element.style.top=t+"px",this.element.style.left=e+"px",this.element.style.display="block",this.closed=!1},n.prototype=Object.create(a.prototype),n.prototype.constructor=n,n.prototype.createContent=function(e){var t=document.createTextNode(e.getChildProperties("id").length);this.element.appendChild(t)}},function(e,t){"use strict";function a(e){this.tree=e,this.cel=document.createElement("canvas"),this.cel.id=this.tree.containerElement.id+"Navi",this.cel.style.zIndex="100",this.cel.style.backgroundColor="#FFFFFF",this.cel.width=this.tree.canvas.canvas.width/3,this.cel.height=this.tree.canvas.canvas.height/3,this.cel.style.position="absolute",this.cel.style.bottom="0px",this.cel.style.right="0px",this.cel.style.border="1px solid #CCCCCC",this.tree.containerElement.appendChild(this.cel),this.ctx=this.cel.getContext("2d"),this.ctx.translate(this.cel.width/2,this.cel.height/2),this.ctx.save()}a.prototype.drawFrame=function(){var e,t,a,n=this.cel.width,i=this.cel.height,r=n/2,s=i/2;this.ctx.restore(),this.ctx.save(),this.ctx.clearRect(-r,-s,n,i),this.ctx.strokeStyle="rgba(180,180,255,1)",this.tree.drawn?this.ctx.drawImage(this.img,-r,-s,this.cel.width,this.cel.height):(e=this.tree.canvas.canvas.toDataURL(),this.img=document.createElement("img"),this.img.src=e,t=this,this.img.onload=function(){t.ctx.drawImage(t.img,-r,-s,t.cel.width,t.cel.height)},this.baseOffsetx=this.tree.offsetx,this.baseOffsety=this.tree.offsety,this.baseZoom=this.tree.zoom),a=1/(this.tree.zoom/this.baseZoom),this.ctx.lineWidth=this.ctx.lineWidth/a,this.ctx.translate((this.baseOffsetx-this.tree.offsetx*a)*a,(this.baseOffsety-this.tree.offsety*a)*a),this.ctx.scale(a,a),this.ctx.strokeRect(-r,-s,n,i)},a.prototype.resize=function(){this.cel.width=this.tree.canvas.canvas.width/3,this.cel.height=this.tree.canvas.canvas.height/3,this.ctx.translate(this.cel.width/2,this.cel.height/2),this.drawFrame()},e.exports=a},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(12),r=n(i),s=a(17),l=n(s),h=a(20),o=n(h),c=a(23),u=n(c),d=a(26),f=n(d);t["default"]={rectangular:r["default"],circular:l["default"],radial:o["default"],diagonal:u["default"],hierarchical:f["default"]}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(13),r=n(i),s=a(14),l=n(s),h=a(15),o=n(h),c=a(16),u=n(c),d={getX:function(e){return e.tree.farthestNodeFromRootX*e.tree.currentBranchScale},getY:function(e){return e.centery},getLabelOffset:function(e){return e.tree.farthestNodeFromRootX*e.tree.currentBranchScale-e.centerx}};t["default"]={branchRenderer:new r["default"](o["default"]),prerenderer:new l["default"](u["default"]),labelAlign:d,branchScalingAxis:"x"}},function(e,t){"use strict";function a(e){if(!e||!e.draw)throw new Error("`draw` function is required for branch renderers");this.draw=e.draw,this.prepareChild=e.prepareChild}a.prototype.render=function(e,t,a){var n;if(!a&&t&&(t.selected?t.canvas.fillStyle=e.selectedColour:t.canvas.fillStyle=t.colour,t.canvas.strokeStyle=t.getColour(),this.draw(e,t),!t.pruned))for(t.drawNode(),n=0;n<t.children.length;n++)this.prepareChild&&this.prepareChild(t,t.children[n]),this.render(e,t.children[n],t.collapsed||a)},e.exports=a},function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=function(){function e(t){a(this,e),this.getStep=t.getStep,this.calculate=t.calculate}return n(e,[{key:"run",value:function(e){var t=this.getStep(e);e.root.startx=0,e.root.starty=0,e.root.centerx=0,e.root.centery=0,e.farthestNodeFromRootX=0,e.farthestNodeFromRootY=0,e.currentBranchScale=1,this.calculate(e,t),e.initialBranchScalar=e.branchScalar,e.root.startx=e.root.centerx,e.root.starty=e.root.centery,e.setFontSize(t),e.setMaxLabelLength()}}]),e}();t["default"]=i},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={draw:function(e,t){var a=t.branchLength*e.branchScalar;t.angle=0,t.parent&&(t.centerx=t.startx+a),t.canvas.beginPath(),t.canvas.moveTo(t.startx,t.starty),t.canvas.lineTo(t.startx,t.centery),t.canvas.lineTo(t.centerx,t.centery),t.canvas.stroke(),t.canvas.closePath()},prepareChild:function(e,t){t.startx=e.centerx,t.starty=e.centery}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={getStep:function(e){return e.fillCanvas?e.canvas.canvas.height/e.leaves.length:Math.max(e.canvas.canvas.height/e.leaves.length,e.leaves[0].getDiameter()+e.labelPadding)},calculate:function(e,t){e.branchScalar=e.canvas.canvas.width/e.maxBranchLength;for(var a=0;a<e.leaves.length;a++){e.leaves[a].angle=0,e.leaves[a].centery=a>0?e.leaves[a-1].centery+t:0,e.leaves[a].centerx=e.leaves[a].totalBranchLength*e.branchScalar,e.leaves[a].centerx>e.farthestNodeFromRootX&&(e.farthestNodeFromRootX=e.leaves[a].centerx),e.leaves[a].centery>e.farthestNodeFromRootY&&(e.farthestNodeFromRootY=e.leaves[a].centery);for(var n=e.leaves[a];n.parent;n=n.parent){var i=n.parent.children;n.parent.centery=(i[0].centery+i[i.length-1].centery)/2}}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(13),r=n(i),s=a(14),l=n(s),h=a(18),o=n(h),c=a(19),u=n(c),d={getX:function(e){return e.centerx+e.labelOffsetX+e.getDiameter()*Math.cos(e.angle)},getY:function(e){return e.centery+e.labelOffsetY+e.getDiameter()*Math.sin(e.angle)},getLabelOffset:function(e){return e.labelOffsetX/Math.cos(e.angle)}};t["default"]={branchRenderer:new r["default"](o["default"]),prerenderer:new l["default"](u["default"]),labelAlign:d,scaleCollapsedNode:function(e){return e/3},calculateFontSize:function(e){return Math.min(10*e+4,40)}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={draw:function(e,t){var a=t.totalBranchLength*e.branchScalar;t.canvas.beginPath(),t.canvas.moveTo(t.startx,t.starty),t.canvas.lineTo(t.centerx,t.centery),t.canvas.stroke(),t.canvas.closePath(),t.canvas.strokeStyle=t.getColour(),t.children.length>1&&!t.collapsed&&(t.canvas.beginPath(),t.canvas.arc(0,0,a,t.minChildAngle,t.maxChildAngle,t.maxChildAngle<t.minChildAngle),t.canvas.stroke(),t.canvas.closePath())}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),i=n.constants.Angles;t["default"]={getStep:function(e){return i.FULL/e.leaves.length},calculate:function(e,t){e.branchScalar=Math.min(e.canvas.canvas.width,e.canvas.canvas.height)/e.maxBranchLength;var a=e.leaves.length*e.leaves[0].getDiameter()/i.FULL;e.branchScalar*e.maxBranchLength>a?a=e.branchScalar*e.maxBranchLength:e.branchScalar=a/e.maxBranchLength;for(var n=0;n<e.leaves.length;n++){var r=e.leaves[n];for(r.angle=t*n,r.startx=r.parent.totalBranchLength*e.branchScalar*Math.cos(r.angle),r.starty=r.parent.totalBranchLength*e.branchScalar*Math.sin(r.angle),r.centerx=r.totalBranchLength*e.branchScalar*Math.cos(r.angle),r.centery=r.totalBranchLength*e.branchScalar*Math.sin(r.angle),r.labelOffsetX=a*Math.cos(r.angle)-r.centerx,r.labelOffsetY=a*Math.sin(r.angle)-r.centery;r.parent&&(0===r.getChildNo()&&(r.parent.angle=r.angle,r.parent.minChildAngle=r.angle),r.getChildNo()===r.parent.children.length-1);r=r.parent)r.parent.maxChildAngle=r.angle,r.parent.angle=(r.parent.minChildAngle+r.parent.maxChildAngle)/2,r.parent.startx=(r.parent.totalBranchLength-r.parent.branchLength)*e.branchScalar*Math.cos(r.parent.angle),r.parent.starty=(r.parent.totalBranchLength-r.parent.branchLength)*e.branchScalar*Math.sin(r.parent.angle),r.parent.centerx=r.parent.totalBranchLength*e.branchScalar*Math.cos(r.parent.angle),r.parent.centery=r.parent.totalBranchLength*e.branchScalar*Math.sin(r.parent.angle)}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(13),r=n(i),s=a(14),l=n(s),h=a(21),o=n(h),c=a(22),u=n(c);t["default"]={branchRenderer:new r["default"](o["default"]),prerenderer:new l["default"](u["default"]),scaleCollapsedNode:function(e){return e/7},calculateFontSize:function(e){return Math.min(50*e+5,15)}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={draw:function(e,t){t.canvas.beginPath(),t.canvas.moveTo(t.startx,t.starty),t.canvas.lineTo(t.centerx,t.centery),t.canvas.stroke(),t.canvas.closePath()}}},function(e,t,a){"use strict";function n(e,t){t.parent?(t.startx=t.parent.centerx,t.starty=t.parent.centery):(t.startx=0,t.starty=0),t.centerx=t.startx+t.branchLength*e.branchScalar*Math.cos(t.angle),t.centery=t.starty+t.branchLength*e.branchScalar*Math.sin(t.angle);for(var a=0;a<t.children.length;a++)n(e,t.children[a])}Object.defineProperty(t,"__esModule",{value:!0});var i=a(2),r=i.constants.Angles;t["default"]={getStep:function(e){return r.FULL/e.leaves.length},calculate:function(e,t){e.branchScalar=Math.min(e.canvas.canvas.width,e.canvas.canvas.height)/e.maxBranchLength;for(var a=0;a<e.leaves.length;a+=1){e.leaves[a].angle=t*a,e.leaves[a].centerx=e.leaves[a].totalBranchLength*e.branchScalar*Math.cos(e.leaves[a].angle),e.leaves[a].centery=e.leaves[a].totalBranchLength*e.branchScalar*Math.sin(e.leaves[a].angle);for(var i=e.leaves[a];i.parent&&(0===i.getChildNo()&&(i.parent.angle=0),i.parent.angle+=i.angle*i.getChildCount(),i.getChildNo()===i.parent.children.length-1);i=i.parent)i.parent.angle=i.parent.angle/i.parent.getChildCount()}n(e,e.root)}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(13),r=n(i),s=a(14),l=n(s),h=a(24),o=n(h),c=a(25),u=n(c);t["default"]={branchRenderer:new r["default"](o["default"]),prerenderer:new l["default"](u["default"]),calculateFontSize:function(e){return Math.min(e/2,10)}}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={draw:function(e,t){t.angle=0,t.canvas.beginPath(),t.canvas.moveTo(t.startx,t.starty),t.canvas.lineTo(t.centerx,t.centery),t.canvas.stroke(),t.canvas.closePath()},prepareChild:function(e,t){t.startx=e.centerx,t.starty=e.centery}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),i=n.constants.Angles;t["default"]={getStep:function(e){return Math.max(e.canvas.canvas.height/e.leaves.length,e.leaves[0].getDiameter()+e.labelPadding)},calculate:function(e,t){for(var a=0;a<e.leaves.length;a++){e.leaves[a].centerx=0,e.leaves[a].centery=a>0?e.leaves[a-1].centery+t:0,e.leaves[a].angle=0;for(var n=e.leaves[a];n.parent&&n.getChildNo()===n.parent.children.length-1;n=n.parent){n.parent.centery=n.parent.getChildYTotal()/n.parent.getChildCount(),n.parent.centerx=n.parent.children[0].centerx+(n.parent.children[0].centery-n.parent.centery)*Math.tan(i.FORTYFIVE);for(var r=0;r<n.parent.children.length;r++)n.parent.children[r].startx=n.parent.centerx,n.parent.children[r].starty=n.parent.centery}}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(13),r=n(i),s=a(14),l=n(s),h=a(27),o=n(h),c=a(28),u=n(c),d={getX:function(e){return e.centerx},getY:function(e){return e.tree.farthestNodeFromRootY*e.tree.currentBranchScale},getLabelOffset:function(e){return e.tree.farthestNodeFromRootY*e.tree.currentBranchScale-e.centery}};t["default"]={branchRenderer:new r["default"](o["default"]),prerenderer:new l["default"](u["default"]),labelAlign:d,branchScalingAxis:"y"}},function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t["default"]={draw:function(e,t){var a=t.branchLength*e.branchScalar;t.parent&&(t.centery=t.starty+a),t.canvas.beginPath(),t!==t.tree.root&&(t.canvas.moveTo(t.startx,t.starty),t.canvas.lineTo(t.centerx,t.starty)),t.canvas.lineTo(t.centerx,t.centery),t.canvas.stroke(),t.canvas.closePath()},prepareChild:function(e,t){t.startx=e.centerx,t.starty=e.centery}}},function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n=a(2),i=n.constants.Angles;t["default"]={getStep:function(e){return e.fillCanvas?e.canvas.canvas.width/e.leaves.length:Math.max(e.canvas.canvas.width/e.leaves.length,e.leaves[0].getDiameter()+e.labelPadding)},calculate:function(e,t){e.branchScalar=e.canvas.canvas.height/e.maxBranchLength;for(var a=0;a<e.leaves.length;a++){e.leaves[a].angle=i.QUARTER,e.leaves[a].centerx=a>0?e.leaves[a-1].centerx+t:0,e.leaves[a].centery=e.leaves[a].totalBranchLength*e.branchScalar;for(var n=e.leaves[a];n.parent&&(0===n.getChildNo()&&(n.parent.centerx=n.centerx),n.getChildNo()===n.parent.children.length-1);n=n.parent){n.parent.angle=i.QUARTER,n.parent.centerx=(n.parent.centerx+n.centerx)/2,n.parent.centery=n.parent.totalBranchLength*e.branchScalar;for(var r=0;r<n.parent.children.length;r++)n.parent.children[r].startx=n.parent.centerx,n.parent.children[r].starty=n.parent.centery}e.leaves[a].centerx>e.farthestNodeFromRootX&&(e.farthestNodeFromRootX=e.leaves[a].centerx),e.leaves[a].centery>e.farthestNodeFromRootY&&(e.farthestNodeFromRootY=e.leaves[a].centery)}}}},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}Object.defineProperty(t,"__esModule",{value:!0});var i=a(30),r=n(i),s=a(31),l=n(s),h=a(32),o=n(h);t["default"]={nexus:new r["default"](o["default"]),newick:new r["default"](l["default"])}},function(e,t){"use strict";function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),i=function(){function e(t){var n=t.format,i=t.parseFn,r=t.fileExtension,s=t.validator;a(this,e),this.format=n,this.parseFn=i,this.fileExtension=r,this.validator=s}return n(e,[{key:"parse",value:function(e,t){var a=e.formatString,n=e.root,i=e.options,r=void 0===i?{validate:!0}:i;return a.match(this.validator)||r.validate===!1?this.parseFn({string:a,root:n,options:r},t):t(new Error('Format string does not validate as "'+this.format+'"'))}}]),e}();t["default"]=i},function(e,t,a){"use strict";function n(e){return e&&e.__esModule?e:{"default":e}}function i(e){return this===e}function r(e){var t="",a=!0,n=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var h=s.value;if(g.some(i.bind(h)))break;t+=h}}catch(o){n=!0,r=o}finally{try{!a&&l["return"]&&l["return"]()}finally{if(n)throw r}}return t}function s(e,t){var a=e.split("**"),n={};if(t.id=a[0],1!==a.length){a=a[1].split("*");for(var i=0;i<a.length;i+=2){var r=a[i+1];switch(a[i]){case"nsz":n.size=window.parseInt(r);break;case"nsh":n.shape=r;break;case"ncol":n.colour=r}}t.setDisplay(n)}}function l(e){var t="",a=!0,n=!1,r=void 0;try{for(var s,l=e[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var h=s.value;if(y.some(i.bind(h)))break;t+=h}}catch(o){n=!0,r=o}finally{try{!a&&l["return"]&&l["return"]()}finally{if(n)throw r}}return t}function h(e,t,a){var n=r(t.slice(a)),i=a+n.length,h="";return n.match(/\*/)&&s(n,e),":"===t[i]?(h=l(t.slice(i+1)),e.branchLength=Math.max(parseFloat(h),0)):e.branchLength=0,n&&(e.label=n),e.id=n||u["default"].generateId(),i+h.length}function o(e,t){for(var a=e.string,n=e.root,i=a.replace(/(\r|\n)/g,""),r=n,s=0;s<i.length;s++){var l=void 0;switch(i[s]){case"(":l=new u["default"],r.addChild(l),r=l;break;case")":r=r.parent;break;case",":l=new u["default"],r.parent.addChild(l),r=l;break;case";":break;default:try{s=h(r,i,s)}catch(o){return t(o)}}}return t()}Object.defineProperty(t,"__esModule",{value:!0});var c=a(7),u=n(c),d="newick",f=/\.nwk$/,v=/^[\w\W\.\*\:(\),-\/]+;?\s*$/gi,g=[":",",",")",";"],y=[")",",",";"];t["default"]={format:d,fileExtension:f,validator:v,parseFn:o}},function(e,t,a){"use strict";function n(e,t){var a=e.string,n=e.root,r=e.options;if(!a.match(/BEGIN TREES/gi))return t(new Error("The nexus file does not contain a tree block"));var s=r.name,l=a.match(/BEGIN TREES;[\S\s]+END;/i)[0].replace(/BEGIN TREES;\n/i,"").replace(/END;/i,""),h={},o=l.match(/TRANSLATE[^;]+;/i);if(o&&o.length){o=o[0],l=l.replace(o,""),o=o.replace(/translate|;/gi,"");for(var c=o.split(","),u=0;u<c.length;u++){var d=c[u].trim().replace("\n","").split(" ");d[0]&&d[1]&&(h[d[0].trim()]=d[1].trim())}}for(var f=l.split("\n"),v={},g=0;g<f.length;g++)if(""!==f[g].trim()){var y=f[g].replace(/tree\s/i,"");s||(s=y.trim().match(/^\w+/)[0]),v[s]=y.trim().match(/[\S]*$/)[0]}return v[s]?void(0,i.parseFn)({string:v[s].trim(),root:n},function(e){if(e)return t(e);if(t(),h){var a=!0,i=!1,r=void 0;try{for(var s,l=Object.keys(h)[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var o=s.value,c=n.tree.branches,u=c[o];delete c[o],u.id=h[o],c[u.id]=u}}catch(d){i=!0,r=d}finally{try{!a&&l["return"]&&l["return"]()}finally{if(i)throw r}}n.tree.draw()}}):new Error("tree "+s+" does not exist in this NEXUS file")}Object.defineProperty(t,"__esModule",{value:!0});var i=a(31),r="nexus",s=/\.n(ex|xs)$/,l=/^#NEXUS[\s\n;\w\W\.\*\:(\),-=\[\]\/&]+$/i;t["default"]={parseFn:n,format:r,fileExtension:s,validator:l}}])});